<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Verificaci√≥n Post-Deploy - Lima Rose</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh; 
            padding: 20px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .content { padding: 30px; }
        .test-section { 
            background: #f8f9fa; 
            border-radius: 10px; 
            padding: 25px; 
            margin: 20px 0; 
            border-left: 5px solid #e91e63;
        }
        .test-button { 
            background: #e91e63; 
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 25px; 
            cursor: pointer; 
            margin: 8px; 
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .test-button:hover { 
            background: #c2185b; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }
        .result { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-top: 15px; 
            font-family: 'Courier New', monospace; 
            white-space: pre-wrap;
            border: 1px solid #e0e0e0;
        }
        .success { border-left: 4px solid #4caf50; background: #f1f8e9; }
        .error { border-left: 4px solid #f44336; background: #ffebee; }
        .warning { border-left: 4px solid #ff9800; background: #fff3e0; }
        .info { border-left: 4px solid #2196f3; background: #e3f2fd; }
        .status-indicator { 
            display: inline-block; 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            margin-right: 8px; 
        }
        .status-success { background: #4caf50; }
        .status-error { background: #f44336; }
        .status-pending { background: #ff9800; }
        .links-section { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 25px; 
            border-radius: 10px; 
            margin: 20px 0; 
        }
        .links-section a { 
            color: white; 
            text-decoration: none; 
            border-bottom: 2px solid rgba(255,255,255,0.3); 
            transition: all 0.3s ease;
        }
        .links-section a:hover { 
            border-bottom-color: white; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåπ Lima Rose Florer√≠a</h1>
            <p>Verificaci√≥n Post-Deploy en Netlify</p>
        </div>
        
        <div class="content">
            <div class="links-section">
                <h3>üîó Links importantes:</h3>
                <p>üìÑ <strong>Sitio principal:</strong> <a href="/" target="_blank">Ir al sitio</a></p>
                <p>üîê <strong>Panel admin:</strong> <a href="/admin-new.html" target="_blank">Ir al admin</a></p>
                <p>üß™ <strong>Test APIs:</strong> <a href="/test-api.html" target="_blank">Probar APIs</a></p>
                <p>üìã <strong>Credenciales:</strong> admin / limarose2025</p>
            </div>

            <div class="test-section">
                <h3>üîç 1. Verificar APIs</h3>
                <p>Probar que las Netlify Functions funcionan correctamente:</p>
                <button class="test-button" onclick="testAPI('/api/products', 'GET')">üõçÔ∏è GET Productos</button>
                <button class="test-button" onclick="testLogin()">üîê Test Login</button>
                <button class="test-button" onclick="testAddProduct()">‚ûï Agregar Producto</button>
                <div id="api-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>üì± 2. Verificar Frontend</h3>
                <p>Comprobar que el sitio principal carga correctamente:</p>
                <button class="test-button" onclick="testFrontend()">üåê Test P√°gina Principal</button>
                <button class="test-button" onclick="testAdminPanel()">üë®‚Äçüíº Test Panel Admin</button>
                <div id="frontend-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>‚öôÔ∏è 3. Verificar Configuraci√≥n</h3>
                <p>Verificar variables de entorno y configuraci√≥n de Netlify:</p>
                <button class="test-button" onclick="checkEnvironment()">üîß Check Variables</button>
                <button class="test-button" onclick="checkSSL()">üîí Check SSL</button>
                <div id="config-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>‚úÖ 4. Checklist Final</h3>
                <div id="checklist">
                    <p><span class="status-indicator status-pending"></span> APIs funcionando</p>
                    <p><span class="status-indicator status-pending"></span> Frontend cargando</p>
                    <p><span class="status-indicator status-pending"></span> Login funcional</p>
                    <p><span class="status-indicator status-pending"></span> Panel admin accesible</p>
                    <p><span class="status-indicator status-pending"></span> SSL activo</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let checklistItems = ['APIs funcionando', 'Frontend cargando', 'Login funcional', 'Panel admin accesible', 'SSL activo'];
        let completedChecks = new Set();

        function updateChecklist(item, status) {
            if (status) completedChecks.add(item);
            
            const indicators = document.querySelectorAll('.status-indicator');
            indicators.forEach((indicator, index) => {
                const itemName = checklistItems[index];
                if (completedChecks.has(itemName)) {
                    indicator.className = 'status-indicator status-success';
                }
            });
        }

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = content;
        }

        async function testAPI(endpoint, method = 'GET', body = null) {
            try {
                showResult('api-result', 'Probando API...', 'info');
                
                const options = { method };
                if (body) {
                    options.headers = { 'Content-Type': 'application/json' };
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(endpoint, options);
                const data = await response.text();
                
                if (response.ok) {
                    showResult('api-result', `‚úÖ ${method} ${endpoint}\nStatus: ${response.status}\nResponse: ${data}`, 'success');
                    updateChecklist('APIs funcionando', true);
                } else {
                    showResult('api-result', `‚ùå ${method} ${endpoint}\nStatus: ${response.status}\nError: ${data}`, 'error');
                }
            } catch (error) {
                showResult('api-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testLogin() {
            await testAPI('/api/login', 'POST', {
                username: 'admin',
                password: 'limarose2025'
            });
            updateChecklist('Login funcional', true);
        }

        async function testAddProduct() {
            await testAPI('/api/products', 'POST', {
                name: 'Producto Test ' + Date.now(),
                price: 99.99,
                category: 'test',
                description: 'Producto de prueba post-deploy',
                filter: 'products'
            });
        }

        function testFrontend() {
            showResult('frontend-result', 'Verificando frontend...', 'info');
            
            try {
                // Check if we can load the main page elements
                const hasProducts = document.querySelector('#products-grid') !== null;
                const hasNavigation = document.querySelector('nav') !== null;
                const hasCSS = getComputedStyle(document.body).fontFamily !== '';
                
                if (window.location.href.includes('localhost')) {
                    showResult('frontend-result', '‚ö†Ô∏è  Ejecutando en localhost\nPara prueba completa, usar URL de Netlify', 'warning');
                } else {
                    showResult('frontend-result', `‚úÖ Frontend verificado\n- Elementos DOM: OK\n- CSS cargado: OK\n- URL producci√≥n: OK`, 'success');
                    updateChecklist('Frontend cargando', true);
                }
            } catch (error) {
                showResult('frontend-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        function testAdminPanel() {
            try {
                window.open('/admin-new.html', '_blank');
                showResult('frontend-result', '‚úÖ Panel admin abierto en nueva pesta√±a\nVerificar manualmente el login', 'success');
                updateChecklist('Panel admin accesible', true);
            } catch (error) {
                showResult('frontend-result', `‚ùå Error al abrir admin: ${error.message}`, 'error');
            }
        }

        function checkEnvironment() {
            const isNetlify = window.location.hostname.includes('netlify.app');
            const hasHTTPS = window.location.protocol === 'https:';
            
            let result = `üåê Entorno detectado:\n`;
            result += `- Hostname: ${window.location.hostname}\n`;
            result += `- Protocol: ${window.location.protocol}\n`;
            result += `- Es Netlify: ${isNetlify ? 'S√≠' : 'No'}\n`;
            result += `- HTTPS: ${hasHTTPS ? 'Activo' : 'Inactivo'}\n`;
            
            if (isNetlify && hasHTTPS) {
                showResult('config-result', result + '\n‚úÖ Configuraci√≥n correcta', 'success');
            } else {
                showResult('config-result', result + '\n‚ö†Ô∏è  Revisar configuraci√≥n', 'warning');
            }
        }

        function checkSSL() {
            const hasHTTPS = window.location.protocol === 'https:';
            
            if (hasHTTPS) {
                showResult('config-result', '‚úÖ SSL activo\nCertificado v√°lido y seguro', 'success');
                updateChecklist('SSL activo', true);
            } else {
                showResult('config-result', '‚ö†Ô∏è  SSL no detectado\nVerificar configuraci√≥n en Netlify', 'warning');
            }
        }

        // Auto-run some checks on load
        window.onload = function() {
            setTimeout(() => {
                testAPI('/api/products', 'GET');
            }, 1000);
            
            setTimeout(() => {
                checkEnvironment();
            }, 2000);
            
            setTimeout(() => {
                checkSSL();
            }, 3000);
        };
    </script>
</body>
</html>